# Copyright 2025 Supabase, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Stale PR Management

on:
  schedule:
    # Run daily at 00:00 UTC
    - cron: "0 0 * * *"
  workflow_dispatch: # Allow manual triggering for testing

permissions: {}

jobs:
  stale:
    name: Mark stale pull requests
    runs-on: ubuntu-latest

    permissions:
      pull-requests: write
      issues: write

    steps:
      - name: Mark stale pull requests
        uses: actions/stale@997185467fa4f803885201cee163a9f38240193d # v10.1.1
        with:
          # Scope: PRs only (not issues)
          days-before-issue-stale: -1
          days-before-issue-close: -1

          # Timing: 30 days until stale, 7 days until close
          days-before-pr-stale: 30
          days-before-pr-close: 7

          # Labels
          stale-pr-label: "stale"
          exempt-pr-labels: "keep"

          # Assignees: Do NOT exempt (default is false)
          exempt-all-pr-assignees: false

          # Messages
          stale-pr-message: |
            This pull request has been inactive for 30 days and will be closed in 7 days if there is no further activity.

            If you would like to keep this PR open, please:
            - Add the `keep` label
            - Add a comment with a status update
            - Push new commits

          close-pr-message: |
            This pull request was closed due to inactivity. Feel free to reopen it or create a new PR if you'd like to continue this work.

          # Behavior
          remove-stale-when-updated: true
          operations-per-run: 30

          # Required for authentication
          repo-token: ${{ secrets.GITHUB_TOKEN }}
